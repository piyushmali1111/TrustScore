<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seller Details - TrustScore</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="dashboard-page light-mode">
    <aside class="sidebar">
        <div class="sidebar-logo">
            <i class="fas fa-shield-halved"></i>
            <span>TrustScore</span>
        </div>
        <nav class="sidebar-nav">
            <a href="admin_dashboard.html"><i class="fas fa-chart-pie"></i> Overview</a>
            <a href="sellers.html" class="active"><i class="fas fa-users"></i> Sellers List</a>
            <a href="risk-analysis.html"><i class="fas fa-triangle-exclamation"></i> Risk Analysis</a>
            <a href="#" id="logoutBtn" class="logout"><i class="fas fa-right-from-bracket"></i> Logout</a>
        </nav>
    </aside>

    <main class="main-content">
        <header class="detail-header">
            <div>
                <h1 id="sellerName">Loading...</h1>
                <p class="subtitle">Detailed performance metrics and analysis</p>
            </div>
            <a href="sellers.html" class="btn btn-primary"><i class="fas fa-arrow-left"></i> Back to List</a>
        </header>

        <!-- Top Stats Row -->
        <section class="stats-card-row">
            <div class="card-clean text-center">
                <p class="label">Trust Score</p>
                <div class="value-large text-primary-blue" id="trustScore">--</div>
            </div>
            <div class="card-clean text-center">
                <p class="label">Risk Level</p>
                <div class="value-large">
                    <span class="trust-badge" id="riskBadge">--</span>
                </div>
            </div>
            <div class="card-clean text-center">
                <p class="label">Confidence Score</p>
                <div class="value-large text-primary-blue" id="confidenceScore">--</div>
            </div>
        </section>

        <!-- Charts Row -->
        <section class="charts-row-split">
            <div class="card-clean">
                <h3><i class="fas fa-chart-radar"></i> Performance Metrics</h3>
                <div class="chart-container-radar">
                    <canvas id="detailsRadarChart"></canvas>
                </div>
            </div>
            <div class="card-clean">
                <h3><i class="fas fa-search"></i> Review Analysis</h3>
                <div class="review-analysis-container">
                    <div class="review-alert alert-red">
                        <div class="alert-icon"><i class="fas fa-times-circle"></i></div>
                        <div class="alert-content">
                            <h4>Fake Reviews Detected</h4>
                        </div>
                        <div class="alert-value" id="fakeReviews">0</div>
                    </div>

                    <div class="review-alert alert-green">
                        <div class="alert-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="alert-content">
                            <h4>Real Reviews</h4>
                        </div>
                        <div class="alert-value" id="realReviews">0</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Detailed Metrics Grid -->
        <section class="detailed-metrics-section">
            <h3><i class="fas fa-list"></i> Detailed Metrics</h3>
            <div class="metrics-grid-detailed">
                <div class="metric-box">
                    <div class="m-icon text-blue"><i class="fas fa-truck"></i></div>
                    <p>DELIVERY SCORE</p>
                    <h2 id="mDelivery">--</h2>
                </div>
                <div class="metric-box">
                    <div class="m-icon text-orange"><i class="fas fa-rotate-left"></i></div>
                    <p>RETURN SCORE</p>
                    <h2 id="mReturn">--</h2>
                </div>
                <div class="metric-box">
                    <div class="m-icon text-green"><i class="fas fa-clock"></i></div>
                    <p>RESPONSE SCORE</p>
                    <h2 id="mResponse">--</h2>
                </div>
                <div class="metric-box">
                    <div class="m-icon text-blue"><i class="fas fa-certificate"></i></div>
                    <p>AUTHENTICITY SCORE</p>
                    <h2 id="mAuthenticity">--</h2>
                </div>
                <div class="metric-box">
                    <div class="m-icon text-green"><i class="fas fa-sitemap"></i></div>
                    <p>CONSISTENCY SCORE</p>
                    <h2 id="mConsistency">--</h2>
                </div>
                <div class="metric-box">
                    <div class="m-icon text-blue"><i class="fas fa-calendar-check"></i></div>
                    <p>ACCOUNT AGE SCORE</p>
                    <h2 id="mAge">--</h2>
                </div>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const sellerId = urlParams.get('id');

            if (!sellerId) {
                alert('No Seller ID provided');
                window.location.href = 'sellers.html';
                return;
            }

            try {
                // Reuse the buyer endpoint as it contains all necessary scoring details
                const res = await fetch(`/api/buyer/${sellerId}`);
                const data = await res.json();

                if (res.ok) {
                    // Header & Top Stats
                    document.getElementById('sellerName').textContent = data.seller_name;
                    document.getElementById('trustScore').textContent = data.trust_score;
                    document.getElementById('confidenceScore').textContent = data.confidence_score + '%';

                    const rb = document.getElementById('riskBadge');
                    rb.textContent = data.risk_level;
                    rb.className = `trust-badge risk-${data.risk_level.toLowerCase()}`;

                    // Review Analysis
                    document.getElementById('fakeReviews').textContent = data.stats.fake_reviews;
                    document.getElementById('realReviews').textContent = data.stats.real_reviews;

                    // Detailed Metrics
                    document.getElementById('mDelivery').textContent = data.metrics.delivery;
                    document.getElementById('mReturn').textContent = data.metrics.return_rate_score;
                    document.getElementById('mResponse').textContent = data.metrics.response;
                    document.getElementById('mAuthenticity').textContent = data.metrics.authenticity;
                    document.getElementById('mConsistency').textContent = data.metrics.consistency;
                    document.getElementById('mAge').textContent = data.metrics.age;

                    // Radar Chart
                    const ctx = document.getElementById('detailsRadarChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'radar',
                        data: {
                            labels: ['Delivery', 'Returns', 'Response', 'Authenticity', 'Consistency', 'Age'],
                            datasets: [{
                                label: 'Seller Metrics',
                                data: [
                                    data.metrics.delivery,
                                    data.metrics.return_rate_score,
                                    data.metrics.response,
                                    data.metrics.authenticity,
                                    data.metrics.consistency,
                                    data.metrics.age
                                ],
                                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                                borderColor: '#3b82f6',
                                pointBackgroundColor: '#3b82f6',
                                pointBorderColor: '#fff',
                                pointHoverBackgroundColor: '#fff',
                                pointHoverBorderColor: '#3b82f6'
                            }]
                        },
                        options: {
                            scales: {
                                r: {
                                    angleLines: { color: '#e5e7eb' },
                                    grid: { color: '#e5e7eb' },
                                    pointLabels: { color: '#64748b', font: { size: 12 } },
                                    ticks: { display: false, max: 100, min: 0 }
                                }
                            },
                            plugins: {
                                legend: { display: false }
                            }
                        }
                    });

                } else {
                    alert('Seller not found');
                }
            } catch (err) {
                console.error(err);
                alert('Error fetching data');
            }
        });
    </script>
</body>

</html>